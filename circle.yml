test:
  override:
    - echo "There is no test"
dependencies:
  override:
    - echo "Don't build with npm"
deployment:
  staging:
    branch: /(feature|fix|chore).*/
    commands:
      - rsync -rptz -e ssh --delete ./ prerender@webserver-stage.risevision.com:/docker-images/prerender
      - ssh prerender@webserver-stage.risevision.com 'cd /docker-images/prerender && sudo make cleanbuild remove run'
      # Webserver build must be triggered manualy
      #- echo "Trigger docker-webserver build"
      #- curl -X POST https://circleci.com/api/v1/project/Rise-Vision/docker-webserver/tree/stage?circle-token=$DOCKER_WEBSERVER_TOKEN
  production:
    branch: master
    commands:
      - rsync -rptz -e ssh --delete ./ prerender@webserver.risevision.com:/docker-images/prerender
      - ssh prerender@webserver.risevision.com 'cd /docker-images/prerender && sudo make cleanbuild remove run'
      - echo "Trigger docker-webserver build"
      - curl -X POST https://circleci.com/api/v1/project/Rise-Vision/docker-webserver/tree/master?circle-token=$DOCKER_WEBSERVER_TOKEN
